Faisal Movers Transport Booking Assistant ‚Äì Node Documentation
________________________________________
### 1. Manual Trigger ‚Äî When clicking ‚ÄòExecute workflow‚Äô
Triggers the workflow manually for testing.
Purpose: Starts the RAG-loading process when executed.
________________________________________
### 2. Google Drive ‚Äî Download file
Downloads the CSV file containing Faisal Movers transport data.
Purpose: Supplies raw dataset for embeddings and vector store.
Credentials Required: Google Drive OAuth2
________________________________________
### 3. Default Data Loader
Converts downloaded binary file into a readable document format.
Purpose: Prepares content for Supabase vector insertion.
________________________________________
### 4. Supabase Vector Store (Insert Mode)
Inserts processed documents into the Supabase vector store.
Purpose: Stores embeddings for RAG search.
Credentials Required: Supabase API
________________________________________
### 5. Chat Trigger ‚Äî When chat message received
Public webhook that triggers the conversational agent for user messages.
Purpose: Starts real-time chat workflow.
________________________________________
### 6. Supabase Vector Store (Retrieve Tool Mode)
Provides RAG search capability to the AI Agent.
Purpose: Returns relevant Faisal Movers data from vector embeddings.
Credentials Required: Supabase API
________________________________________
### 7. Postgres Chat Memory
Stores recent chat interactions for memory-based responses.
Purpose: Allows context persistence across messages.
Credentials Required: Postgres
________________________________________
### 8. Google Gemini/Open Ai Chat Model
Large language model powering the AI Agent.
Purpose: Generates conversational responses based on RAG + rules.
Credentials Required: Google Gemini/PaLM API/Open Ai
________________________________________
### 9. Embeddings ‚Äî Google Gemini/Open Ai
Generates embeddings for text to be stored in Supabase.
Purpose: Enables semantic search in vector store.
Credentials Required: Google Gemini/PaLM API/Open Ai
________________________________________
### 10. AI Agent
Main decision-making agent following rules:
‚Ä¢	RAG answers
‚Ä¢	Booking mode
‚Ä¢	JSON output for ticket booking
Purpose: Handles all user queries.
________________________________________
### 11. JSON-OUTPUT
Extracts JSON from AI agent responses.
Purpose: Ensures structured booking data is passed to logic nodes.
________________________________________
### 12. Switch
Routes flow based on intent:
‚Ä¢	check_info ‚Üí general info
‚Ä¢	book_ticket ‚Üí ticket booking
Purpose: Splits conversation logic.
________________________________________
### 13. Supabase ‚Äî Fetch Fare Prices
Queries fare based on:
‚Ä¢	source
‚Ä¢	destination
‚Ä¢	bus class
Purpose: Retrieves fare per route.
Credentials Required: Supabase API
________________________________________
### 14. Merge
Combines:
‚Ä¢	Fare details
‚Ä¢	User booking details
Purpose: Prepares unified data for fare calculation.
________________________________________
### 15. Fare_Calculation
Computes:
totalFare = fare_price_pkr * seat_quantity
Purpose: Final fare calculation.
________________________________________
### 16. Stripe ‚Äî Create Checkout Session
Creates a Stripe checkout page for ticket payment.
Purpose: Payment processing for ticket booking.
Credentials Required: Stripe Secret Key
________________________________________
### 17. Bitly ‚Äî URL Shortener
Shortens payment URL for user-friendly messaging.
Purpose: Provides clean payment link.
Credentials Required: Bitly API
________________________________________
### 18. Code in JavaScript (Extract Payment Link)
Extracts only the final short link from Bitly response.
Purpose: Sends simplified payment instructions.
________________________________________
### 19. Webhook ‚Äî Stripe Payment Webhook
Receives Stripe payment confirmation.
Purpose: Validates ticket payment.
________________________________________
### 20. Code1 ‚Äî Parse Stripe Signature Header
Extracts necessary fields from stripe-signature.
Purpose: Used for signature verification.
________________________________________
### 21. Crypto1 ‚Äî Verify Stripe Signature
Generates HMAC SHA256 signature.
Purpose: Confirms webhook authenticity.
________________________________________
### 22. If ‚Äî Signature Validity Check
Checks:
‚Ä¢	signature validity
‚Ä¢	webhook type
‚Ä¢	timestamp freshness
Purpose: Prevents fraudulent callbacks.
________________________________________
### 23. Edit Fields
Extracts customer & ticket details from Stripe webhook.
Fields:
‚Ä¢	Email
‚Ä¢	Name
‚Ä¢	Fare
‚Ä¢	Booking ID
Purpose: Prepare email data.
________________________________________
### 24. Stop and Error
Stops workflow if verification fails.
Purpose: Security enforcement.
________________________________________
### 25. Gmail ‚Äî Send a message
Sends confirmation email with e-ticket.
Purpose: Delivers ticket to customer.
Credentials Required: Gmail OAuth2

________________________________________
üîê Credentials Required Overview
Service	Used In Nodes	Credential Required
Google Drive	Download File	Google Drive OAuth2
Supabase	Vector Store (insert + retrieve), Fare Query	Supabase API
Postgres	Chat Memory	Postgres Credentials
Google Gemini / PaLM	Chat Model + Embeddings	Google PaLM API
Stripe	Create Checkout Session, Webhook Validation	Stripe Secret Key
Gmail	Send Email	Gmail OAuth2
Bitly	URL Shortening	Bitly API

